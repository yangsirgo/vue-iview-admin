(function($) {
	var defaults = null,
		classNames = null,
		methods = null;
	defaults = {
		value: 0,
		textColor: null,
		textSuffix: "%",
		type: "positive",
		isShowText: true,
		animateTime: 500
	}, classNames = {
		container: "percentbar",
		text: "percentbartext",
		image: "percentbarimage"
	}, methods = {
		_init: function(options) {
			return this.each(function() {
				var opts = $.extend({}, defaults, options),
					$this = $(this).data("options", opts).addClass(classNames.container);
				if (opts.isShowText) {
					$("<div/>").addClass(classNames.text).css("color", opts.textColor).appendTo($this)
				}
				$("<div/>").addClass(classNames.image).addClass(opts.type).appendTo($this);
				methods.change.call($this, opts.value)
			})
		},
		change: function(value) {
			return this.each(function() {
				var $this = $(this),
					opts = methods.options.call($this, null);
				if (opts.isShowText) {
					$this.children("." + classNames.text).html(value + opts.textSuffix)
				}
				$this.children("." + classNames.image).stop(true, true).animate({
					width: value + "%"
				}, opts.animateTime, function() {
					$(this).css("width", value + "%")
				});
				opts.value = value
			})
		},
		options: function() {
			return this.data("options")
		}
	};
	$.fn.percentbar = function() {
		var arg0 = arguments[0];
		if (methods[arg0]) {
			return methods[arg0].apply(this, Array.prototype.slice.call(arguments, 1))
		} else {
			if (typeof arg0 === "object" || !arg0) {
				return methods._init.apply(this, arguments)
			} else {
				$.error("Method " + arg0 + " does not exist on jquery.percentbar.");
				return this
			}
		}
	}
})(jQuery);